<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
      xmlns:fn="http://xmlns.jcp.org/jsp/jstl/functions">

<ui:composition template="/WEB-INF/templates/template.xhtml">
    
    <ui:define name="title">
        #{msg['admin.categories.title']} - #{applicationBean.applicationName}
    </ui:define>
    
    <ui:define name="css">
        <!-- Referência: Sistema de Temas Claros e Escuros - project_rules.md -->
        <style type="text/css">
            .admin-header {
                background: linear-gradient(135deg, var(--blue-primary) 0%, var(--blue-secondary) 100%);
                color: var(--text-on-primary);
                padding: 2rem 0;
                margin-bottom: 2rem;
                border-radius: 10px;
                box-shadow: var(--shadow-lg);
            }
            
            .admin-title {
                font-size: 2rem;
                font-weight: bold;
                margin-bottom: 0.5rem;
            }
            
            .admin-subtitle {
                opacity: 0.9;
                font-size: 1.1rem;
            }
            
            .stats-cards {
                margin-bottom: 2rem;
            }
            
            .stat-card {
                background: var(--bg-primary);
                border-radius: 10px;
                padding: 1.5rem;
                box-shadow: var(--shadow-md);
                text-align: center;
                transition: all 0.3s ease;
                border: 1px solid var(--border-color);
            }
            
            .stat-card:hover {
                transform: translateY(-2px);
                box-shadow: var(--shadow-lg);
            }
            
            .stat-icon {
                font-size: 2.5rem;
                margin-bottom: 1rem;
            }
            
            .stat-number {
                font-size: 2rem;
                font-weight: bold;
                color: var(--text-primary);
                margin-bottom: 0.5rem;
            }
            
            .stat-label {
                color: var(--text-secondary);
                font-size: 0.9rem;
                text-transform: uppercase;
                letter-spacing: 0.5px;
            }
            
            .stat-total { color: var(--blue-primary); }
            .stat-active { color: #10b981; }
            .stat-inactive { color: #f59e0b; }
            .stat-news { color: #8b5cf6; }
            
            .filters-panel {
                background: var(--bg-primary);
                border-radius: 10px;
                padding: 1.5rem;
                margin-bottom: 2rem;
                box-shadow: var(--shadow-md);
                border: 1px solid var(--border-color);
            }
            
            .data-table-container {
                background: var(--bg-primary);
                border-radius: 10px;
                padding: 1.5rem;
                box-shadow: var(--shadow-md);
                border: 1px solid var(--border-color);
            }
            
            .category-info {
                display: flex;
                align-items: center;
            }
            
            .category-icon {
                width: 40px;
                height: 40px;
                border-radius: 8px;
                display: flex;
                align-items: center;
                justify-content: center;
                margin-right: 1rem;
                font-size: 1.2rem;
                color: white;
                background: linear-gradient(135deg, #3b82f6, #1e40af);
            }
            
            .category-details {
                flex: 1;
            }
            
            .category-name {
                font-weight: 600;
                color: var(--text-primary);
                margin-bottom: 0.25rem;
                line-height: 1.3;
            }
            
            .category-description {
                color: var(--text-secondary);
                font-size: 0.9rem;
                line-height: 1.4;
            }
            
            .status-badge {
                padding: 0.25rem 0.75rem;
                border-radius: 20px;
                font-size: 0.8rem;
                font-weight: 500;
                text-transform: uppercase;
                letter-spacing: 0.5px;
            }
            
            .status-active {
                background: #d1fae5;
                color: #065f46;
            }
            
            .status-inactive {
                background: #fef3c7;
                color: #92400e;
            }
            
            .news-count {
                display: flex;
                align-items: center;
                gap: 0.5rem;
                font-weight: 600;
                color: #374151;
            }
            
            .news-count-badge {
                background: #e5e7eb;
                color: #374151;
                padding: 0.2rem 0.6rem;
                border-radius: 12px;
                font-size: 0.8rem;
                font-weight: 500;
            }
            
            .action-buttons {
                display: flex;
                gap: 0.5rem;
            }
            
            .btn-sm {
                padding: 0.375rem 0.75rem;
                font-size: 0.875rem;
            }
            
            .toolbar {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 1.5rem;
                flex-wrap: wrap;
                gap: 1rem;
            }
            
            .bulk-actions {
                display: flex;
                gap: 0.5rem;
                align-items: center;
            }
            
            .search-box {
                min-width: 300px;
            }
            
            .dialog-content {
                padding: 1rem;
            }
            
            .form-group {
                margin-bottom: 1.5rem;
            }
            
            .form-label {
                display: block;
                margin-bottom: 0.5rem;
                font-weight: 600;
                color: #374151;
            }
            
            .required {
                color: #dc2626;
            }
            
            .color-picker {
                display: flex;
                gap: 0.5rem;
                align-items: center;
            }
            
            .color-preview {
                width: 30px;
                height: 30px;
                border-radius: 6px;
                border: 2px solid #e5e7eb;
            }
            
            .usage-stats {
                background: #f8fafc;
                border-radius: 8px;
                padding: 1rem;
                margin-top: 1rem;
            }
            
            .usage-item {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 0.5rem 0;
                border-bottom: 1px solid #e5e7eb;
            }
            
            .usage-item:last-child {
                border-bottom: none;
            }
            
            .usage-label {
                color: #6b7280;
                font-size: 0.9rem;
            }
            
            .usage-value {
                font-weight: 600;
                color: #374151;
            }
            
            @media (max-width: 768px) {
                .admin-title {
                    font-size: 1.5rem;
                }
                
                .toolbar {
                    flex-direction: column;
                    align-items: stretch;
                }
                
                .search-box {
                    min-width: auto;
                }
                
                .bulk-actions {
                    justify-content: center;
                }
                
                .action-buttons {
                    flex-direction: column;
                }
                
                .category-info {
                    flex-direction: column;
                    align-items: flex-start;
                }
                
                .category-icon {
                    margin-right: 0;
                    margin-bottom: 0.5rem;
                }
            }
        </style>
    </ui:define>
    
    <ui:define name="content">
        <!-- Referência: Sistema de Temas Claros e Escuros - project_rules.md -->
        <!-- Referência: Controle de Acesso - project_rules.md -->
        
        <!-- Controle de Acesso: Apenas ADMINISTRADOR, FUNDADOR e COLABORADOR podem acessar -->
        <c:if test="#{authBean.hasRole('ADMINISTRADOR') or authBean.hasRole('FUNDADOR') or authBean.hasRole('COLABORADOR')}">
        
        <!-- Cabeçalho Admin -->
        <div class="admin-header">
            <div class="container">
                <div class="row">
                    <div class="col-12">
                        <h1 class="admin-title">
                            <i class="pi pi-tags"></i>
                            #{msg['admin.categories.title']}
                        </h1>
                        <p class="admin-subtitle">#{msg['admin.categories.subtitle']}</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="container">
            <!-- Cards de Estatísticas -->
            <div class="stats-cards">
                <div class="row">
                    <div class="col-lg-3 col-md-6 mb-3">
                        <div class="stat-card">
                            <div class="stat-icon stat-total">
                                <i class="pi pi-tags"></i>
                            </div>
                            <div class="stat-number">#{categoriaAdminBean.totalCategorias}</div>
                            <div class="stat-label">#{msg['admin.stats.total.categories']}</div>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6 mb-3">
                        <div class="stat-card">
                            <div class="stat-icon stat-active">
                                <i class="pi pi-check-circle"></i>
                            </div>
                            <div class="stat-number">#{categoriaAdminBean.categoriasAtivas}</div>
                            <div class="stat-label">#{msg['admin.stats.active.categories']}</div>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6 mb-3">
                        <div class="stat-card">
                            <div class="stat-icon stat-inactive">
                                <i class="pi pi-times-circle"></i>
                            </div>
                            <div class="stat-number">#{categoriaAdminBean.categoriasInativas}</div>
                            <div class="stat-label">#{msg['admin.stats.inactive.categories']}</div>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6 mb-3">
                        <div class="stat-card">
                            <div class="stat-icon stat-news">
                                <i class="pi pi-file"></i>
                            </div>
                            <div class="stat-number">#{categoriaAdminBean.totalNoticiasCategorizadas}</div>
                            <div class="stat-label">#{msg['admin.stats.categorized.news']}</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Painel de Filtros -->
            <div class="filters-panel">
                <h:form id="filtersForm">
                    <div class="row align-items-end">
                        <div class="col-lg-3 col-md-6 mb-3">
                            <label class="form-label">#{msg['filter.status']}</label>
                            <p:selectOneMenu value="#{categoriaAdminBean.filtroStatus}" 
                                           styleClass="form-control">
                                <f:selectItem itemLabel="#{msg['filter.all']}" itemValue=""/>
                                <f:selectItem itemLabel="#{msg['status.active']}" itemValue="true"/>
                                <f:selectItem itemLabel="#{msg['status.inactive']}" itemValue="false"/>
                            </p:selectOneMenu>
                        </div>
                        
                        <div class="col-lg-3 col-md-6 mb-3">
                            <label class="form-label">#{msg['filter.news.count']}</label>
                            <p:selectOneMenu value="#{categoriaAdminBean.filtroQuantidadeNoticias}" 
                                           styleClass="form-control">
                                <f:selectItem itemLabel="#{msg['filter.all']}" itemValue=""/>
                                <f:selectItem itemLabel="#{msg['filter.with.news']}" itemValue="with"/>
                                <f:selectItem itemLabel="#{msg['filter.without.news']}" itemValue="without"/>
                                <f:selectItem itemLabel="#{msg['filter.many.news']}" itemValue="many"/>
                            </p:selectOneMenu>
                        </div>
                        
                        <div class="col-lg-3 col-md-6 mb-3">
                            <label class="form-label">#{msg['filter.creation.date']}</label>
                            <p:calendar value="#{categoriaAdminBean.dataInicio}" 
                                      pattern="#{msg['date.format.input']}"
                                      showOn="button"
                                      styleClass="form-control"/>
                        </div>
                        
                        <div class="col-lg-3 col-md-6 mb-3">
                            <p:commandButton value="#{msg['button.filter']}" 
                                           action="#{categoriaAdminBean.aplicarFiltros}"
                                           update="categoriesTable"
                                           styleClass="btn btn-primary me-2"
                                           icon="pi pi-search"/>
                            <p:commandButton value="#{msg['button.clear']}" 
                                           action="#{categoriaAdminBean.limparFiltros}"
                                           update="filtersForm categoriesTable"
                                           styleClass="btn btn-outline-secondary"
                                           icon="pi pi-times"/>
                        </div>
                    </div>
                </h:form>
            </div>
            
            <!-- Tabela de Categorias -->
            <div class="data-table-container">
                <div class="toolbar">
                    <div class="bulk-actions">
                        <p:commandButton value="#{msg['button.new.category']}" 
                                       onclick="PF('categoryDialog').show()" 
                                       styleClass="btn btn-success"
                                       icon="pi pi-plus"/>
                        
                        <p:commandButton value="#{msg['button.activate.selected']}" 
                                       action="#{categoriaAdminBean.ativarSelecionadas}"
                                       update="categoriesTable"
                                       styleClass="btn btn-outline-success btn-sm"
                                       icon="pi pi-check"
                                       disabled="#{empty categoriaAdminBean.categoriasSelecionadas}"/>
                        
                        <p:commandButton value="#{msg['button.deactivate.selected']}" 
                                       action="#{categoriaAdminBean.desativarSelecionadas}"
                                       update="categoriesTable"
                                       styleClass="btn btn-outline-warning btn-sm"
                                       icon="pi pi-times"
                                       disabled="#{empty categoriaAdminBean.categoriasSelecionadas}"/>
                        
                        <p:commandButton value="#{msg['button.delete.selected']}" 
                                       action="#{categoriaAdminBean.excluirSelecionadas}"
                                       update="categoriesTable"
                                       styleClass="btn btn-outline-danger btn-sm"
                                       icon="pi pi-trash"
                                       disabled="#{empty categoriaAdminBean.categoriasSelecionadas}">
                            <p:confirm header="#{msg['confirm.title']}" 
                                     message="#{msg['confirm.delete.selected.categories']}"
                                     icon="pi pi-exclamation-triangle"/>
                        </p:commandButton>
                    </div>
                    
                    <div class="search-box">
                        <h:form>
                            <p:inputText value="#{categoriaAdminBean.termoPesquisa}" 
                                       placeholder="#{msg['search.categories.placeholder']}"
                                       styleClass="form-control">
                                <p:ajax event="keyup" 
                                      listener="#{categoriaAdminBean.pesquisar}" 
                                      update="categoriesTable" 
                                      delay="500"/>
                            </p:inputText>
                        </h:form>
                    </div>
                </div>
                
                <h:form id="categoriesTableForm">
                    <p:dataTable id="categoriesTable" 
                               value="#{categoriaAdminBean.categorias}" 
                               var="categoria"
                               lazy="true"
                               paginator="true"
                               rows="15"
                               paginatorPosition="both"
                               paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                               rowsPerPageTemplate="10,15,25"
                               selection="#{categoriaAdminBean.categoriasSelecionadas}"
                               rowKey="#{categoria.id}"
                               styleClass="table table-striped"
                               emptyMessage="#{msg['table.no.records']}"
                               currentPageReportTemplate="#{msg['table.pagination.template']}">
                        
                        <p:column selectionMode="multiple" style="width:3rem"/>
                        
                        <p:column headerText="#{msg['table.category.info']}" sortBy="#{categoria.nome}" style="width:40%">
                            <div class="category-info">
                                <div class="category-icon" style="background-color: #{categoria.cor}">
                                    <i class="pi pi-tag"></i>
                                </div>
                                
                                <div class="category-details">
                                    <div class="category-name">#{categoria.nome}</div>
                                    <div class="category-description">
                                        #{fn:substring(categoria.descricao, 0, 100)}#{fn:length(categoria.descricao) > 100 ? '...' : ''}
                                    </div>
                                </div>
                            </div>
                        </p:column>
                        
                        <p:column headerText="#{msg['table.status']}" sortBy="#{categoria.ativa}" style="width:10%">
                            <span class="status-badge #{categoria.ativa ? 'status-active' : 'status-inactive'}">
                                <i class="pi #{categoria.ativa ? 'pi-check' : 'pi-times'}"></i>
                                #{categoria.ativa ? msg['status.active'] : msg['status.inactive']}
                            </span>
                        </p:column>
                        
                        <p:column headerText="#{msg['table.news.count']}" sortBy="#{categoria.quantidadeNoticias}" style="width:12%">
                            <div class="news-count">
                                <i class="pi pi-file"></i>
                                <span class="news-count-badge">#{categoria.quantidadeNoticias}</span>
                            </div>
                        </p:column>
                        
                        <p:column headerText="#{msg['table.creation.date']}" sortBy="#{categoria.dataCriacao}" style="width:12%">
                            <h:outputText value="#{categoria.dataCriacao}">
                                <f:convertDateTime pattern="#{msg['date.format.short']}"/>
                            </h:outputText>
                        </p:column>
                        
                        <p:column headerText="#{msg['table.last.update']}" sortBy="#{categoria.dataAtualizacao}" style="width:12%">
                            <h:outputText value="#{categoria.dataAtualizacao}" rendered="#{categoria.dataAtualizacao != null}">
                                <f:convertDateTime pattern="#{msg['date.format.short']}"/>
                            </h:outputText>
                            <span class="text-muted" rendered="#{categoria.dataAtualizacao == null}">#{msg['never.updated']}</span>
                        </p:column>
                        
                        <p:column headerText="#{msg['table.actions']}" style="width:14%">
                            <div class="action-buttons">
                                <p:commandButton icon="pi pi-eye" 
                                               title="#{msg['button.view']}"
                                               action="#{categoriaAdminBean.visualizarCategoria(categoria)}"
                                               styleClass="btn btn-outline-info btn-sm"/>
                                
                                <p:commandButton icon="pi pi-pencil" 
                                               title="#{msg['button.edit']}"
                                               action="#{categoriaAdminBean.editarCategoria(categoria)}"
                                               oncomplete="PF('categoryDialog').show()"
                                               update="categoryDialogContent"
                                               styleClass="btn btn-outline-primary btn-sm"/>
                                
                                <p:commandButton icon="#{categoria.ativa ? 'pi pi-times' : 'pi pi-check'}" 
                                               title="#{categoria.ativa ? msg['button.deactivate'] : msg['button.activate']}"
                                               action="#{categoriaAdminBean.alternarStatus(categoria)}"
                                               update="categoriesTable"
                                               styleClass="btn #{categoria.ativa ? 'btn-outline-warning' : 'btn-outline-success'} btn-sm">
                                    <p:confirm header="#{msg['confirm.title']}" 
                                             message="#{categoria.ativa ? msg['confirm.deactivate.category'] : msg['confirm.activate.category']}"
                                             icon="pi pi-exclamation-triangle"/>
                                </p:commandButton>
                                
                                <p:commandButton icon="pi pi-trash" 
                                               title="#{msg['button.delete']}"
                                               action="#{categoriaAdminBean.excluirCategoria(categoria)}"
                                               update="categoriesTable"
                                               styleClass="btn btn-outline-danger btn-sm"
                                               disabled="#{categoria.quantidadeNoticias > 0}">
                                    <p:confirm header="#{msg['confirm.title']}" 
                                             message="#{msg['confirm.delete.category']}"
                                             icon="pi pi-exclamation-triangle"/>
                                </p:commandButton>
                            </div>
                        </p:column>
                    </p:dataTable>
                </h:form>
            </div>
        </div>
        
        <!-- Dialog de Categoria -->
        <p:dialog id="categoryDialog" 
                widgetVar="categoryDialog" 
                header="#{categoriaAdminBean.editando ? msg['dialog.edit.category'] : msg['dialog.new.category']}"
                modal="true" 
                width="600" 
                height="500"
                resizable="true"
                closeOnEscape="true">
            
            <div id="categoryDialogContent">
                <h:form id="categoryForm">
                    <div class="dialog-content">
                        <div class="form-group">
                            <label class="form-label">
                                #{msg['form.name']} <span class="required">*</span>
                            </label>
                            <p:inputText value="#{categoriaAdminBean.categoriaEdicao.nome}" 
                                       styleClass="form-control"
                                       required="true"
                                       requiredMessage="#{msg['validation.name.required']}"
                                       maxlength="100"/>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">#{msg['form.description']}</label>
                            <p:inputTextarea value="#{categoriaAdminBean.categoriaEdicao.descricao}" 
                                           rows="4"
                                           styleClass="form-control"
                                           maxlength="500"/>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">#{msg['form.color']}</label>
                            <div class="color-picker">
                                <p:colorPicker value="#{categoriaAdminBean.categoriaEdicao.cor}" 
                                             mode="popup"
                                             styleClass="form-control"/>
                                <div class="color-preview" style="background-color: #{categoriaAdminBean.categoriaEdicao.cor}"></div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <p:selectBooleanCheckbox value="#{categoriaAdminBean.categoriaEdicao.ativa}" 
                                                   itemLabel="#{msg['form.active.category']}"/>
                        </div>
                        
                        <!-- Estatísticas de Uso (apenas para edição) -->
                        <div class="usage-stats" rendered="#{categoriaAdminBean.editando}">
                            <h6>#{msg['form.usage.statistics']}</h6>
                            
                            <div class="usage-item">
                                <span class="usage-label">#{msg['stats.total.news']}</span>
                                <span class="usage-value">#{categoriaAdminBean.categoriaEdicao.quantidadeNoticias}</span>
                            </div>
                            
                            <div class="usage-item">
                                <span class="usage-label">#{msg['stats.published.news']}</span>
                                <span class="usage-value">#{categoriaAdminBean.categoriaEdicao.noticiasPublicadas}</span>
                            </div>
                            
                            <div class="usage-item">
                                <span class="usage-label">#{msg['stats.draft.news']}</span>
                                <span class="usage-value">#{categoriaAdminBean.categoriaEdicao.rascunhos}</span>
                            </div>
                            
                            <div class="usage-item">
                                <span class="usage-label">#{msg['stats.creation.date']}</span>
                                <span class="usage-value">
                                    <h:outputText value="#{categoriaAdminBean.categoriaEdicao.dataCriacao}">
                                        <f:convertDateTime pattern="#{msg['date.format.full']}"/>
                                    </h:outputText>
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="dialog-footer d-flex justify-content-end gap-2 mt-3">
                        <p:commandButton value="#{msg['button.cancel']}" 
                                       onclick="PF('categoryDialog').hide()" 
                                       styleClass="btn btn-outline-secondary"
                                       type="button"/>
                        
                        <p:commandButton value="#{msg['button.save']}" 
                                       action="#{categoriaAdminBean.salvarCategoria}"
                                       update="categoriesTable categoryDialogContent"
                                       oncomplete="if (args && !args.validationFailed) PF('categoryDialog').hide()"
                                       styleClass="btn btn-success"
                                       icon="pi pi-check"/>
                    </div>
                </h:form>
            </div>
        </p:dialog>
        
        <!-- Dialog de Visualização -->
        <p:dialog id="viewCategoryDialog" 
                widgetVar="viewCategoryDialog" 
                header="#{msg['dialog.view.category']}"
                modal="true" 
                width="700" 
                height="600"
                resizable="true"
                closeOnEscape="true">
            
            <div class="dialog-content" rendered="#{categoriaAdminBean.categoriaVisualizacao != null}">
                <div class="row">
                    <div class="col-md-6">
                        <h5>#{msg['form.basic.info']}</h5>
                        
                        <div class="mb-3">
                            <strong>#{msg['form.name']}:</strong><br/>
                            #{categoriaAdminBean.categoriaVisualizacao.nome}
                        </div>
                        
                        <div class="mb-3">
                            <strong>#{msg['form.description']}:</strong><br/>
                            #{categoriaAdminBean.categoriaVisualizacao.descricao}
                        </div>
                        
                        <div class="mb-3">
                            <strong>#{msg['form.color']}:</strong><br/>
                            <div class="d-flex align-items-center gap-2">
                                <div class="color-preview" style="background-color: #{categoriaAdminBean.categoriaVisualizacao.cor}"></div>
                                #{categoriaAdminBean.categoriaVisualizacao.cor}
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <strong>#{msg['form.status']}:</strong><br/>
                            <span class="status-badge #{categoriaAdminBean.categoriaVisualizacao.ativa ? 'status-active' : 'status-inactive'}">
                                #{categoriaAdminBean.categoriaVisualizacao.ativa ? msg['status.active'] : msg['status.inactive']}
                            </span>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <h5>#{msg['form.statistics']}</h5>
                        
                        <div class="usage-stats">
                            <div class="usage-item">
                                <span class="usage-label">#{msg['stats.total.news']}</span>
                                <span class="usage-value">#{categoriaAdminBean.categoriaVisualizacao.quantidadeNoticias}</span>
                            </div>
                            
                            <div class="usage-item">
                                <span class="usage-label">#{msg['stats.published.news']}</span>
                                <span class="usage-value">#{categoriaAdminBean.categoriaVisualizacao.noticiasPublicadas}</span>
                            </div>
                            
                            <div class="usage-item">
                                <span class="usage-label">#{msg['stats.draft.news']}</span>
                                <span class="usage-value">#{categoriaAdminBean.categoriaVisualizacao.rascunhos}</span>
                            </div>
                            
                            <div class="usage-item">
                                <span class="usage-label">#{msg['stats.creation.date']}</span>
                                <span class="usage-value">
                                    <h:outputText value="#{categoriaAdminBean.categoriaVisualizacao.dataCriacao}">
                                        <f:convertDateTime pattern="#{msg['date.format.full']}"/>
                                    </h:outputText>
                                </span>
                            </div>
                            
                            <div class="usage-item" rendered="#{categoriaAdminBean.categoriaVisualizacao.dataAtualizacao != null}">
                                <span class="usage-label">#{msg['stats.last.update']}</span>
                                <span class="usage-value">
                                    <h:outputText value="#{categoriaAdminBean.categoriaVisualizacao.dataAtualizacao}">
                                        <f:convertDateTime pattern="#{msg['date.format.full']}"/>
                                    </h:outputText>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Lista de Notícias da Categoria -->
                <div class="mt-4" rendered="#{categoriaAdminBean.categoriaVisualizacao.quantidadeNoticias > 0}">
                    <h5>#{msg['form.category.news']}</h5>
                    
                    <p:dataTable value="#{categoriaAdminBean.noticiasCategoria}" 
                               var="noticia"
                               styleClass="table table-sm"
                               emptyMessage="#{msg['table.no.news']}">
                        
                        <p:column headerText="#{msg['table.title']}">
                            #{noticia.titulo}
                        </p:column>
                        
                        <p:column headerText="#{msg['table.status']}">
                            <span class="status-badge #{noticia.publicada ? 'status-published' : 'status-draft'}">
                                #{noticia.publicada ? msg['status.published'] : msg['status.draft']}
                            </span>
                        </p:column>
                        
                        <p:column headerText="#{msg['table.date']}">
                            <h:outputText value="#{noticia.dataPublicacao}" rendered="#{noticia.publicada}">
                                <f:convertDateTime pattern="#{msg['date.format.short']}"/>
                            </h:outputText>
                            <h:outputText value="#{noticia.dataCriacao}" rendered="#{not noticia.publicada}">
                                <f:convertDateTime pattern="#{msg['date.format.short']}"/>
                            </h:outputText>
                        </p:column>
                    </p:dataTable>
                </div>
            </div>
            
            <div class="dialog-footer d-flex justify-content-end mt-3">
                <p:commandButton value="#{msg['button.close']}" 
                               onclick="PF('viewCategoryDialog').hide()" 
                               styleClass="btn btn-outline-secondary"
                               type="button"/>
            </div>
        </p:dialog>
        
        <!-- Confirmação -->
        <p:confirmDialog global="true" showEffect="fade" hideEffect="fade" responsive="true" width="350">
            <p:commandButton value="#{msg['button.yes']}" type="button" styleClass="btn btn-primary ui-confirmdialog-yes" icon="pi pi-check"/>
            <p:commandButton value="#{msg['button.no']}" type="button" styleClass="btn btn-outline-secondary ui-confirmdialog-no" icon="pi pi-times"/>
        </p:confirmDialog>
    </ui:define>
    
    <ui:define name="javascript">
        <script type="text/javascript">
            // Atualizar estatísticas periodicamente
            // Referência: Sistema de Temas Claros e Escuros - project_rules.md
            // Esta função deve considerar as cores do tema ativo para exibição das estatísticas
            function updateCategoryStats() {
                if (typeof PrimeFaces !== 'undefined') {
                    // Implementar atualização automática das estatísticas
                }
            }
            
            // Atualizar a cada 30 segundos
            setInterval(updateCategoryStats, 30000);
            
            // Contador de caracteres
            document.addEventListener('DOMContentLoaded', function() {
                const nameInput = document.querySelector('input[id*="nome"]');
                const descriptionTextarea = document.querySelector('textarea[id*="descricao"]');
                
                function addCharCounter(element, maxChars) {
                    if (element) {
                        const counter = document.createElement('small');
                        counter.className = 'form-text text-muted float-end';
                        element.parentNode.appendChild(counter);
                        
                        function updateCounter() {
                            const remaining = maxChars - element.value.length;
                            counter.textContent = `${remaining} caracteres restantes`;
                            counter.style.color = remaining < 20 ? '#dc3545' : '#6c757d';
                        }
                        
                        element.addEventListener('input', updateCounter);
                        updateCounter();
                    }
                }
                
                addCharCounter(nameInput, 100);
                addCharCounter(descriptionTextarea, 500);
            });
            
            // Atalhos de teclado
            document.addEventListener('keydown', function(e) {
                // Ctrl+N para nova categoria
                if (e.ctrlKey && e.key === 'n') {
                    e.preventDefault();
                    PF('categoryDialog').show();
                }
                
                // Ctrl+S para salvar (quando dialog estiver aberto)
                if (e.ctrlKey && e.key === 's' && PF('categoryDialog').isVisible()) {
                    e.preventDefault();
                    // Trigger save button
                }
                
                // Escape para fechar dialogs
                if (e.key === 'Escape') {
                    if (PF('categoryDialog').isVisible()) {
                        PF('categoryDialog').hide();
                    }
                    if (PF('viewCategoryDialog').isVisible()) {
                        PF('viewCategoryDialog').hide();
                    }
                }
            });
            
            // Validação de cor
            // Referência: Sistema de Temas Claros e Escuros - project_rules.md
            // Valida cores hexadecimais considerando compatibilidade com temas claro/escuro
            function validateColor(colorInput) {
                const color = colorInput.value;
                const hexPattern = /^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/;
                
                if (color && !hexPattern.test(color)) {
                    alert('Cor inválida. Use o formato hexadecimal (#RRGGBB).');
                    colorInput.focus();
                    return false;
                }
                return true;
            }
            
            // Preview da cor em tempo real
            // Referência: Sistema de Temas Claros e Escuros - project_rules.md
            // Atualiza preview considerando contraste adequado para ambos os temas
            function updateColorPreview() {
                const colorInput = document.querySelector('input[id*="cor"]');
                const colorPreview = document.querySelector('.color-preview');
                
                if (colorInput && colorPreview) {
                    colorInput.addEventListener('input', function() {
                        const color = this.value;
                        if (color) {
                            colorPreview.style.backgroundColor = color;
                        }
                    });
                }
            }
            
            // Inicializar preview da cor quando o dialog abrir
            document.addEventListener('DOMContentLoaded', updateColorPreview);
        </script>
    </ui:define>
    
    <!-- Fechamento do controle de acesso -->
    </c:if>
    
    <!-- Mensagem de acesso negado -->
    <c:if test="#{not (authBean.hasRole('ADMINISTRADOR') or authBean.hasRole('FUNDADOR') or authBean.hasRole('COLABORADOR'))}">
        <div class="container mt-5">
            <div class="alert alert-danger text-center">
                <h4><i class="pi pi-exclamation-triangle"></i> #{msg['access.denied.title']}</h4>
                <p>#{msg['access.denied.admin.message']}</p>
                <p:button value="#{msg['button.back.home']}" outcome="/index" styleClass="btn btn-primary"/>
            </div>
        </div>
    </c:if>
    
</ui:composition>
</html>