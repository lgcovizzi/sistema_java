<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">

<!-- Referência: Sistema de Login e Autenticação - project_rules.md -->
<ui:composition template="/WEB-INF/templates/template.xhtml">
    
    <ui:define name="title">
        Login - #{applicationBean.applicationName}
    </ui:define>
    
    <ui:define name="css">
        <style>
            .login-container {
                min-height: 70vh;
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 2rem 0;
            }
            
            .login-card {
                background: var(--card-background);
                border: 1px solid var(--border-color);
                border-radius: 12px;
                box-shadow: var(--shadow-lg);
                overflow: hidden;
                max-width: 400px;
                width: 100%;
            }
            
            .login-header {
                background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
                color: white;
                padding: 2rem;
                text-align: center;
            }
            
            .login-header h2 {
                margin: 0;
                font-size: 1.5rem;
                font-weight: 600;
            }
            
            .login-body {
                padding: 2rem;
            }
            
            .form-group {
                margin-bottom: 1.5rem;
            }
            
            .form-label {
                display: block;
                margin-bottom: 0.5rem;
                font-weight: 500;
                color: var(--text-primary);
            }
            
            .form-control {
                width: 100%;
                padding: 0.75rem;
                border: 1px solid var(--border-color);
                border-radius: 6px;
                background: var(--input-background);
                color: var(--text-primary);
                font-size: 1rem;
                transition: border-color 0.2s ease, box-shadow 0.2s ease;
            }
            
            .form-control:focus {
                outline: none;
                border-color: var(--primary-color);
                box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            }
            
            .btn-login {
                width: 100%;
                padding: 0.75rem;
                background: var(--primary-color);
                color: white;
                border: none;
                border-radius: 6px;
                font-size: 1rem;
                font-weight: 600;
                cursor: pointer;
                transition: background-color 0.2s ease;
            }
            
            .btn-login:hover {
                background: var(--primary-hover);
            }
            
            .checkbox-group {
                display: flex;
                align-items: center;
                gap: 0.5rem;
                margin-bottom: 1.5rem;
            }
            
            .divider {
                margin: 1.5rem 0;
                border: none;
                border-top: 1px solid var(--border-color);
            }
            
            .login-links {
                text-align: center;
            }
            
            .login-links a {
                color: var(--primary-color);
                text-decoration: none;
                font-weight: 500;
            }
            
            .login-links a:hover {
                text-decoration: underline;
            }
            
            .error-message {
                color: var(--error-color);
                font-size: 0.875rem;
                margin-top: 0.25rem;
            }
            
            .register-link {
                text-align: center;
                margin-top: 1.5rem;
                padding-top: 1.5rem;
                border-top: 1px solid #e5e7eb;
            }
            
            .forgot-password {
                text-align: center;
                margin-top: 1rem;
            }
            
            .forgot-password a {
                color: #1e3a8a;
                text-decoration: none;
                font-size: 0.9rem;
            }
            
            .forgot-password a:hover {
                text-decoration: underline;
            }
            
            .register-form {
                margin-top: 2rem;
                padding-top: 2rem;
                border-top: 1px solid #e5e7eb;
            }
            
            .register-title {
                font-size: 1.5rem;
                font-weight: bold;
                color: #1e3a8a;
                margin-bottom: 1.5rem;
                text-align: center;
            }
            
            .form-row {
                display: flex;
                gap: 1rem;
            }
            
            .form-row .form-group {
                flex: 1;
            }
            
            @media (max-width: 768px) {
                .login-container {
                    padding: 1rem;
                }
                
                .login-header {
                    padding: 1.5rem;
                }
                
                .login-body {
                    padding: 1.5rem;
                }
                
                .form-row {
                    flex-direction: column;
                    gap: 0;
                }
            }
        </style>
    </ui:define>
    
    <ui:define name="content">
        <div class="login-container">
            <div class="login-card" rendered="#{!authBean.mostrarFormularioRegistro}">
                <div class="login-header">
                    <i class="fas fa-sign-in-alt fa-2x mb-3"></i>
                    <h2>Entrar no Sistema</h2>
                    <p class="mb-0 opacity-90">Acesse sua conta para continuar</p>
                </div>
                
                <div class="login-body">
                    <h:form id="loginForm">
                        <div class="form-group">
                            <label for="email" class="form-label">
                                <i class="fas fa-envelope"></i> Email
                            </label>
                            <p:inputText id="email" 
                                       value="#{authBean.emailLogin}" 
                                       styleClass="form-control" 
                                       placeholder="Digite seu email"
                                       required="true"
                                       requiredMessage="Email é obrigatório"
                                       validatorMessage="Email inválido">
                                <f:validateRegex pattern="^[\w\.-]+@[\w\.-]+\.[a-zA-Z]{2,}$"/>
                            </p:inputText>
                            <p:message for="email" styleClass="error-message"/>
                        </div>
                        
                        <div class="form-group">
                            <label for="senha" class="form-label">
                                <i class="fas fa-lock"></i> Senha
                            </label>
                            <p:password id="senha" 
                                      value="#{authBean.senhaLogin}" 
                                      styleClass="form-control" 
                                      placeholder="Digite sua senha"
                                      required="true"
                                      requiredMessage="Senha é obrigatória"
                                      feedback="false"/>
                            <p:message for="senha" styleClass="error-message"/>
                        </div>
                        
                        <div class="checkbox-group">
                            <p:selectBooleanCheckbox id="lembrarMe" 
                                                   value="#{authBean.lembrarMe}"/>
                            <label for="lembrarMe">Lembrar-me neste dispositivo</label>
                        </div>
                        
                        <p:commandButton value="Entrar" 
                                       action="#{authBean.login}"
                                       styleClass="btn-login"
                                       update="loginForm"
                                       icon="fas fa-sign-in-alt"
                                       iconPos="left"/>
                    </h:form>
                    
                    <hr class="divider"/>
                    
                    <div class="login-links">
                        <p class="mb-3">
                            <h:link outcome="esqueci-senha">
                                <i class="fas fa-question-circle"></i> Esqueci minha senha
                            </h:link>
                        </p>
                        <p class="mb-0">
                            Não tem uma conta? 
                            <p:commandButton value="Criar conta" 
                                            action="#{authBean.alternarFormularioRegistro}"
                                            styleClass="btn btn-outline-primary"
                                            update="@form"
                                            process="@this"/>
                        </p>
                    </div>
                </div>
            </div>
            

            
            <!-- Formulário de Registro -->
            <div class="register-form" rendered="#{authBean.mostrarFormularioRegistro}">
                <h2 class="register-title">Criar Conta</h2>
                
                <h:form id="registerForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="nome">Nome *</label>
                            <p:inputText id="nome" 
                                        value="#{authBean.novoUsuario.nome}"
                                        placeholder="Digite seu nome"
                                        required="true"
                                        requiredMessage="Nome é obrigatório"
                                        maxlength="100"
                                        styleClass="form-control"
                                        style="width: 100%"/>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="sobrenome">Sobrenome *</label>
                            <p:inputText id="sobrenome" 
                                        value="#{authBean.novoUsuario.sobrenome}"
                                        placeholder="Digite seu sobrenome"
                                        required="true"
                                        requiredMessage="Sobrenome é obrigatório"
                                        maxlength="100"
                                        styleClass="form-control"
                                        style="width: 100%"/>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="emailReg">Email *</label>
                        <p:inputText id="emailReg" 
                                    value="#{authBean.novoUsuario.email}"
                                    placeholder="Digite seu email"
                                    required="true"
                                    requiredMessage="Email é obrigatório"
                                    maxlength="150"
                                    styleClass="form-control"
                                    style="width: 100%"/>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="cpf">CPF *</label>
                        <p:inputMask id="cpf" 
                                    value="#{authBean.novoUsuario.cpf}"
                                    mask="999.999.999-99"
                                    placeholder="000.000.000-00"
                                    required="true"
                                    requiredMessage="CPF é obrigatório"
                                    styleClass="form-control"
                                    style="width: 100%"/>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="telefone">Telefone</label>
                        <p:inputMask id="telefone" 
                                    value="#{authBean.novoUsuario.telefone}"
                                    mask="(99) 99999-9999"
                                    placeholder="(00) 00000-0000"
                                    styleClass="form-control"
                                    style="width: 100%"/>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="dataNascimento">Data de Nascimento</label>
                        <p:calendar id="dataNascimento" 
                                   value="#{authBean.novoUsuario.dataNascimento}"
                                   pattern="dd/MM/yyyy"
                                   placeholder="dd/mm/aaaa"
                                   showOn="button"
                                   navigator="true"
                                   yearRange="1900:2010"
                                   styleClass="form-control"
                                   style="width: 100%"/>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="senhaReg">Senha *</label>
                            <p:password id="senhaReg" 
                                       value="#{authBean.novoUsuario.senha}"
                                       placeholder="Digite sua senha"
                                       required="true"
                                       requiredMessage="Senha é obrigatória"
                                       feedback="true"
                                       promptLabel="Digite uma senha"
                                       weakLabel="Fraca"
                                       goodLabel="Boa"
                                       strongLabel="Forte"
                                       styleClass="form-control"
                                       style="width: 100%"/>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="confirmaSenha">Confirmar Senha *</label>
                            <p:password id="confirmaSenha" 
                                       value="#{authBean.confirmaSenha}"
                                       placeholder="Confirme sua senha"
                                       required="true"
                                       requiredMessage="Confirmação de senha é obrigatória"
                                       feedback="false"
                                       styleClass="form-control"
                                       style="width: 100%"/>
                        </div>
                    </div>
                    
                    <div class="login-actions">
                        <p:commandButton value="Criar Conta" 
                                        action="#{authBean.registrar}"
                                        styleClass="btn btn-success"
                                        style="width: 100%; padding: 0.75rem;"
                                        update="registerForm"/>
                        
                        <p:commandButton value="Voltar ao Login" 
                                        action="#{authBean.alternarFormularioRegistro}"
                                        styleClass="btn btn-outline-secondary"
                                        style="width: 100%; padding: 0.75rem;"
                                        update="@form"
                                        process="@this"
                                        immediate="true"/>
                    </div>
                </h:form>
            </div>
        </div>
        
        <!-- Redirect authenticated users -->
        <c:if test="#{authBean.authenticated}">
            <f:metadata>
                <f:event type="preRenderView" listener="#{authBean.redirectToDashboard}"/>
            </f:metadata>
        </c:if>
    </ui:define>
    
</ui:composition>
</html>